"use strict";var app=angular.module("app",["ngRoute","ngMask","toastr","blockUI","ui.utils.masks","ui.grid","ui.grid.pagination","ui.grid.autoResize","ui.grid.grouping","ui.grid.selection","perfect_scrollbar","ui.grid.expandable","ui.grid.pinning","ui.grid.exporter"]);app.run(["$rootScope","$location","AuthService","toastr","$window",function(o,r,a,e,i){o.$on("$routeChangeStart",function(s,t,n){e.clear(),"/registro"!==r.path()?(a.isAuthed()||(o.exibeMenuprojetoBiblioteca=!1,r.path("/admin")),null!==i.localStorage.getItem("projetoBiblioteca")?(o.exibeMenuprojetoBiblioteca=!0,o.strNomeUsuarioprojetoBiblioteca=JSON.parse(i.localStorage.getItem("projetoBiblioteca")).strNome,o.intIdUsuarioprojetoBiblioteca=JSON.parse(i.localStorage.getItem("projetoBiblioteca")).idUser):(o.exibeMenuprojetoBiblioteca=!1,r.path("/admin"))):o.exibeMenuprojetoBiblioteca=!1})}]),app.constant("BASEURL","http://127.0.0.1:3001/"),app.config(["$httpProvider",function(o){o.interceptors.push("AuthInterceptor")}]),app.config(["$routeProvider",function(o){o.when("/",{templateUrl:"pages/dashboard.html",controller:"dashboardController"}).when("/usuarios",{templateUrl:"pages/usuarios.html",controller:"usuarioController"}).when("/livros",{templateUrl:"pages/livros.html",controller:"livrosController"}).when("/relatoriosGeral",{templateUrl:"pages/relatoriosGeral.html",controller:"relatoriosGeralController"}).when("/relatoriosUsuarios",{templateUrl:"pages/relatoriosUsuarios.html",controller:"relatoriosUsuariosController"}).when("/relatoriosLivros",{templateUrl:"pages/relatoriosLivros.html",controller:"relatoriosLivrosController"}).when("/editar-senha",{templateUrl:"pages/editar-senha.html",controller:"editarSenhaController"}).when("/admin",{templateUrl:"pages/admin.html",controller:"adminController"}).when("/registro",{templateUrl:"pages/registro.html",controller:"registroController"}).otherwise({redirectTo:"/admin"})}]),app.factory("AuthInterceptor",["BASEURL","AuthService","$q",function(o,r,a){return{request:function(a){var e=r.getToken();return 0===a.url.indexOf(o)&&e&&(a.headers["x-access-token"]=e),a},response:function(a){return 0===a.config.url.indexOf(o)&&a.data.token&&r.saveToken(a.data.token),a},responseError:function(o){return 401===o.status&&r.logout(),a.reject(o)}}}]),app.service("AuthService",["$window","$location","$rootScope",function(o,r,a){this.parseJwt=function(r){var a=r.split(".")[1],e=a.replace("-","+").replace("_","/");return JSON.parse(o.atob(e))},this.saveToken=function(r){var a=[];a={jwtTokenprojetoBiblioteca:r},o.localStorage.setItem("projetoBiblioteca",JSON.stringify(a))},this.getToken=function(){if(null!==o.localStorage.getItem("projetoBiblioteca"))return JSON.parse(o.localStorage.getItem("projetoBiblioteca")).jwtTokenprojetoBiblioteca},this.isAuthed=function(){var o=this.getToken();if(o){return this.parseJwt(o)}return!1},this.logout=function(){o.localStorage.removeItem("projetoBiblioteca"),delete a.strNomeUsuarioprojetoBiblioteca,delete a.intIdUsuarioprojetoBiblioteca,r.path("/admin")}}]),app.config(["toastrConfig",function(o){angular.extend(o,{positionClass:"toast-center-center",closeButton:!0,maxOpened:1,extendedTimeOut:5e3})}]),app.config(["blockUIConfig",function(o){o.message="Carregando..."}]),app.controller("adminController",["$scope","toastr","$rootScope","BASEURL","$window","$location","$http","AuthService",function(o,r,a,e,i,s,t,n){o.usuario={strLogin:"",strSenha:""},o.verificarLogin=function(){var a=e+"users/login";t.post(a,o.usuario).success(function(a){o.verificaToken(a.token)?(n.saveToken(a.token),o.salvaUsuario(a.data[0].id_usuario,a.data[0].nome_usuario),s.path("/")):r.error("Senha informada inválida!")}).error(function(o){r.error("Ocorreu um erro ao fazer o login, tente novamente!")})},o.verificaToken=function(o){return"string"==typeof o&&(null!==JSON.parse(localStorage.getItem("projetoBiblioteca")).jwtTokenprojetoBiblioteca||(n.logout(),!1))},o.salvaUsuario=function(o,r){var a=[];a={strNome:r,idUser:o,jwtTokenprojetoBiblioteca:JSON.parse(i.localStorage.getItem("projetoBiblioteca")).jwtTokenprojetoBiblioteca},i.localStorage.setItem("projetoBiblioteca",JSON.stringify(a))},o.isLoggedIn=function(){a.intIdUsuarioprojetoBiblioteca&&s.path("/")},o.isLoggedIn()}]),app.controller("appController",["$scope","toastr","$window","AuthService","BASEURL",function(o,r,a,e,i){o.doLogout=function(){e.logout()},o.HeaderController=function(o,r){o.isActive=function(o){return o===r.path()}},o.$on("$viewContentLoaded",function(){$("#modalInserirEditar").on("show.bs.modal",function(o){var r=$(o.relatedTarget).data("tipo");$(this).find(".modalTipo").text(r)}),$("#lstBuscaFiltro").change(function(){var o=$(this).val();$(".filtro.open").fadeOut().fadeOut("fast",function(){$(this).removeClass("open"),$("#filtro-"+o).fadeIn().addClass("open")})}),$(document).tooltip({selector:'[data-toggle="tooltip"]'}),$(".datepicker").datetimepicker({locale:"pt-br",viewMode:"days",format:"DD/MM/YYYY"}),$(".datepicker input").mask("99/99/9999"),$(".timepicker").datetimepicker({format:"HH:mm"}),$(".timepicker input").mask("99:99"),jQuery.fn.reset=function(){1==$(this).is("form")?$(this).each(function(){this.reset()}):$(this).is("input")?$(this).val(""):$(this).is(":radio")?$(this).hasClass("first-option")?$(this).prop({checked:!0}):$(this).prop({checked:!1}):$(this).is("select")?$(this).prop("selectedIndex",0):$(this).is("textarea")&&$(this).val("")},$(document).on("shown.bs.tab",function(o){var r=$(o.relatedTarget).attr("data-target");$(r+" form").reset(),$(r+" form").removeClass("ng-submitted"),$(r+" .form-label").each(function(){$(".form-label").removeClass("has-error")}),"#search"===r?($("#search-result").fadeOut().removeClass("show").addClass("hide"),$("#noResult").remove()):"#create"===r&&$(".alert").remove()}),$(window).width()<800?$(".second-nav li").each(function(){$(this).addClass("close-menu")}):$(".second-nav li").each(function(){$(this).removeClass("close-menu")}),$(".close-menu").on("click",function(){$("#sidebar").removeClass("active")})})}]),app.controller("dashboardController",["$scope","$rootScope","BASEURL","$window","$http","toastr","$location","$timeout",function(o,r,a,e,i,s,t,n){o.countLivros=function(){var r=a+"books/count";i.post(r).success(function(r){r.length>=1?o.totalLivros=r[0].totalLivros:s.error("Nào foi possivel buscar nenhum livro cadastro no sistema.")}).error(function(o){s.error("Não foi possível realizar a pesquisa!")})},o.countUsuarios=function(){var r=a+"users/count";i.post(r).success(function(r){r.length>=1?o.totalUsuarios=r[0].totalUsuarios:s.error("Nào foi possivel buscar nenhum usuário cadastro no sistema.")}).error(function(o){s.error("Não foi possível realizar a pesquisa!")})},o.countLivros(),o.countUsuarios()}]),app.controller("editarSenhaController",["$scope","$http","BASEURL","$rootScope","$window","toastr",function(o,r,a,e,i,s){o.request={operacao:"edit_password",oldPasswd:"",confirmPasswd:"",newPasswd:""},o.changePassword=function(){if(o.request.newPasswd.length<6)s.error("A senha digitada deve conter ao menos 6 caracteres!");else if(o.request.newPasswd!==o.request.confirmPasswd)s.error("As senhas digitadas devem ser iguais!");else{var i=a+"users/changepass",t={newPass:o.request.newPasswd,oldPasswd:o.request.oldPasswd,idUser:e.intIdUsuarioprojetoBiblioteca};r.post(i,t).success(function(r){1===r.affectedRows?(s.success("Senha Alterada com sucesso!"),o.request={operacao:"edit_password",oldPasswd:"",confirmPasswd:"",newPasswd:""}):s.error("Não foi possivel alterar sua senha!")}).error(function(o){s.error("Não foi possivel alterar sua senha!")})}}}]),app.controller("livrosController",["$scope","BASEURL","$http","$filter","toastr",function(o,r,a,e,i){o.showDiv=!1,o.carregaLivros=function(){var e=r+"Books";a.put(e).success(function(r){r.length>=1?(o.dadosLivros=r,angular.forEach(o.dadosLivros,function(r,a){r.ativoExibicao=o.retornarDescricaoStatus(r.ativo_livro),r.disponivelExibicao=o.retornarDispoStatus(r.disponivel_livro)}),o.gridOptions1.data=o.dadosLivros):i.error("Não existe nenhum livro cadastrado!")}).error(function(o){i.error("Não foi possível realizar a pesquisa!")})},o.gridOptions1={enableSorting:!0,paginationPageSizes:[10,50,75],paginationPageSize:10,enableVerticalScrollbar:0,rowHeight:35,rowTemplate:'<div ng-class="{ inativo : row.entity.ativo_livro==0 }"> <div ng-repeat="col in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ui-grid-cell></div></div>',columnDefs:[{name:" ",enableColumnMenu:!1,cellTemplate:'<a role="button" data-toggle="modal" data-target="#modalInserirEditar" class="table-icon" data-tipo="Editar" ng-click="grid.appScope.modalAlterarLivro(row.entity);"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>',width:30},{field:"id_livro",displayName:"Código"},{field:"nome_livro",displayName:"Título"},{field:"autor_livro",displayName:"Autor"},{field:"editora_livro",displayName:"Editora"},{field:"ano_livro",displayName:"Ano"},{field:"ativoExibicao",displayName:"Status"},{field:"disponivelExibicao",displayName:"Disponibilidade"}]},o.pesquisarLivros=function(){if(o.showDiv=!0,void 0===o.opcaoBusca||""===o.opcaoBusca)o.carregaLivros();else if(void 0===o.opcaoBusca&&""===o.opcaoBusca||""!==o.gridOptions1.data&&void 0!==o.gridOptions1.data)o.dadosLivrosCopy=angular.copy(o.dadosLivros),o.opcaoBuscaCopy=angular.copy(o.opcaoBusca),o.dadosLivrosCopy=e("filter")(o.dadosLivrosCopy,o.opcaoBuscaCopy),o.gridOptions1.data=o.dadosLivrosCopy;else{var s=r+"Books";a.put(s).success(function(r){r.length>=1?(o.dadosLivros=angular.copy(r),angular.forEach(o.dadosLivros,function(r,a){r.ativoExibicao=o.retornarDescricaoStatus(r.ativo_livro),r.disponivelExibicao=o.retornarDispoStatus(r.disponivel_livro)}),o.dadosLivrosCopy=angular.copy(o.dadosLivros),o.opcaoBuscaCopy=angular.copy(o.opcaoBusca),o.dadosLivrosCopy=e("filter")(o.dadosLivrosCopy,o.opcaoBuscaCopy),o.gridOptions1.data=o.dadosLivrosCopy):i.error("Não foi possível carregar os dados, tente novamente mais tarde!")}).error(function(o){i.error("Não foi possível realizar a pesquisa!")})}},o.cadastrarLivro=function(){if(o.cadastro.strTitulo.length>50)i.error("O numero máximo de caracteres para o título é de 50.");else if(o.cadastro.strAutor.length>50)i.error("O numero máximo de caracteres para o autor é de 50.");else if(o.cadastro.strEditora.length>50)i.error("O numero máximo de caracteres para a editora é de 50.");else if("number"==typeof o.cadastro.strAno)i.error("O ano informado não é válido.");else{var e=r+"books/insert",s=o.cadastro;a.post(e,s).success(function(r){1==r.affectedRows?(i.success("Livro cadastrado com sucesso!"),o.carregaLivros(),$("#modalInserirEditar").modal("toggle")):i.error("Não foi possível cadastrar o livro!")}).error(function(o){i.error("Erro ao cadastrar o livro!")})}},o.modalAlterarLivro=function(r){o.cadastro={intLivro:r.id_livro,blnAtivo:r.ativo_livro,strEditora:r.editora_livro,strTitulo:r.nome_livro,strAutor:r.autor_livro,strAno:r.ano_livro,intOpcao:"1"}},o.opcaoLivro=function(r){"1"===r?o.alterarLivro():o.cadastrarLivro()},o.opcaoLivroCadastro=function(r){o.cadastro={blnAtivo:"0",strEditora:"",strTitulo:"",strAutor:"",strAno:"",intOpcao:"0"}},o.alterarLivro=function(){if(o.cadastro.strTitulo.length>50)i.error("O numero máximo de caracteres para o título é de 50.");else if(o.cadastro.strAutor.length>50)i.error("O numero máximo de caracteres para o autor é de 50.");else if(o.cadastro.strEditora.length>50)i.error("O numero máximo de caracteres para a editora é de 50.");else if("number"==typeof o.cadastro.strAno)i.error("O ano informado não é válido.");else{var e=r+"books/update",s=o.cadastro;a.post(e,s).success(function(r){1==r.affectedRows?(i.success("Livro alterado com sucesso!"),o.carregaLivros(),$("#modalInserirEditar").modal("toggle")):i.error("Não foi possível alterar o livro!")}).error(function(o){i.error("Não foi possível alterar o livro!")})}},o.retornarDescricaoStatus=function(o){return o=parseInt(o),1===o?"Inativo":"Ativo"},o.retornarDispoStatus=function(o){return o=parseInt(o),1===o?"Emprestado":"Disponível"},o.pesquisarLivros()}]),app.controller("registroController",["$scope","$rootScope","toastr","BASEURL","$window","$location","$http","AuthService","$timeout",function(o,r,a,e,i,s,t,n,l){o.usuario={strUser:""},o.livro={intNome:"",intEstado:"",intNota:"",strObs:""},o.intNota=["0","1","2","3","4","5","6","7","8","9","10"],o.verificarRegistro=function(){var r=e+"users";t.post(r,o.usuario).success(function(r){r.length>=1?(o.dadosUsuario=r[0],o.exibeTela="2",o.buscarLivros(),o.estadoLivro()):a.error("Usuario não encontrado.")}).error(function(o){a.error("Ocorreu um erro ao buscar os dados do usuário.")})},o.estadoLivro=function(){var r=e+"Books/cons";t.post(r).success(function(r){r.length>=1?(console.log(r),o.strEstado=r):a.error("Nenhuma lista de estado de conservação encontrada.")}).error(function(o){a.error("Ocorreu um erro ao buscar a lista de estado de conservação.")})},o.buscarLivros=function(){var r=e+"Books";t.get(r).success(function(r){r.length>=1?o.dadosLivros=r:a.error("Não existe nenhum livro cadastrado!")}).error(function(o){a.error("Ocorreu um erro ao buscar os livros.")})},o.enviarDados=function(){if(""==o.livro.intNome)a.error("Por favor selecione um livro!");else if(""==o.livro.intEstado)a.error("Por favor selecione um estado!");else if(""==o.livro.intNota)a.error("Por favor selecione uma nota!");else if(o.livro.strObs.length>256)a.error("O numero máximo de caracteres para a observaçoes é de 256.");else{var r=e+"Reviews/add",i={livro_opiniao:o.livro.intNome.id_livro,estado_opiniao:o.livro.intEstado.id_estado,nota_opiniao:o.livro.intNota,observacao_opiniao:o.livro.strObs,usuario_opiniao:o.dadosUsuario.id_usuario};t.post(r,i).success(function(r){1==r.affectedRows?a.success("Opinião cadastrada com sucesso!"):a.error("Opinião já cadastrada para o livro"),o.livro=[],l(function(){o.exibeTela="3"},1e3)}).error(function(o){a.error("Erro ao cadastrar opinião!")})}},o.exibeTela="1",o.opcaoMenu=function(r){"1"===r?(o.livro={intNome:"",intEstado:"",intNota:"",strObs:""},o.usuario={strUser:""},o.exibeTela="1"):"2"===r?o.exibeTela="2":"3"===r&&(o.exibeTela="3")},o.opcaoLivro=function(r){o.livro.intNome=r},o.opcaoEstado=function(r){o.livro.intEstado=r}}]),app.controller("relatoriosGeralController",["$scope","$rootScope","BASEURL","$window","$http","$timeout","$filter","toastr",function(o,r,a,e,i,s,t,n){o.carregaAvaliacoes=function(){var r=a+"Reviews";i.post(r).success(function(r){r.length>=1?(o.showDiv=!0,o.dadosAvaliacoes=angular.copy(r),o.gridOptions1.data=o.dadosAvaliacoes):n.error("Não existe nenhuma avaliação cadastrada!")}).error(function(o){n.error("Não foi possível realizar a pesquisa!")})},o.gridOptions1={enableSorting:!0,paginationPageSizes:[10,50,75],paginationPageSize:10,enableVerticalScrollbar:0,rowHeight:35,columnDefs:[{field:"id_opiniao",displayName:"Código"},{field:"nome_livro",displayName:"Livro"},{field:"nome_usuario",displayName:"Usuário"},{field:"nota_opiniao",displayName:"Nota",width:100},{field:"estadoExibicao",displayName:"Estado do Livro"},{displayName:"Opinião",name:" ",enableColumnMenu:!1,cellTemplate:'<a role="button" data-toggle="modal" data-target="#modalInserirEditar" class="table-icon" data-tipo="Opinião" ng-click="grid.appScope.modalInserirEditar(row.entity);"><i class="fa fa-search-plus" aria-hidden="true"></i></a>'}]},o.modalInserirEditar=function(r){o.opiniao=r},o.pesquisarAvaliacoes=function(){o.dadosPesquisa=t("filter")(o.dadosAvaliacoes,o.opcaoBusca),o.gridOptions1.data=o.dadosPesquisa},o.carregaAvaliacoes()}]),app.controller("relatoriosLivrosController",["$scope","$rootScope","BASEURL","$window","$http","$timeout","$filter","toastr",function(o,r,a,e,i,s,t,n){o.carregaLivros=function(){var r=a+"Books";i.get(r).success(function(r){r.length>=1?(o.dadosLivros=r,o.carregaAvaliacoes()):n.error("Não existe nenhum livro cadastrado!")}).error(function(o){n.error("Não foi possível realizar a pesquisa!")})},o.carregaAvaliacoes=function(){var r=a+"Reviews";i.post(r).success(function(r){if(r.length>=1){o.dadosAvaliacao=r;var a=[];angular.forEach(o.dadosLivros,function(r,e){var i=[],s=0,t=[];angular.forEach(o.dadosAvaliacao,function(o,a){var e=0;if(r.id_livro==o.livro_opiniao){for(var n={estado_opiniao:o.estado_opiniao,nota_opiniao:o.nota_opiniao},l=0;l<4;l++)o.estado_opiniao==l&&(e++,t.push(e));s+=o.nota_opiniao,i.push(n)}});var n=0,l=0,c=[];(s||0!=s)&&(n=s/i.length);for(var u=0;u<4;u++)t[u]?(l=t[u]/i.length,c.push(l)):c.push(0);var d={id_livro:r.id_livro,nome_livro:r.nome_livro,autor_livro:r.autor_livro,opiniao:i,qtdeOpiniao:i.length,notaMedia:n,PorcentagemOpiniao:c};a.push(d)}),o.showDiv=!0,o.gridOptions1.data=a}else n.error("Não existe nenhuma avaliação cadastrada!")}).error(function(o){n.error("Não foi possível realizar a pesquisa!")})},o.gridOptions1={enableSorting:!0,paginationPageSizes:[10,50,75],paginationPageSize:10,enableVerticalScrollbar:0,rowHeight:100,columnDefs:[{field:"id_livro",displayName:"Código"},{field:"nome_livro",displayName:"Livro"},{field:"autor_livro",displayName:"Autor"},{field:"qtdeOpiniao",displayName:"Total de Avaliações"},{field:"opiniao",displayName:"Estado de Conservação",cellTemplate:"<div>Ótimo ---- {{row.entity.PorcentagemOpiniao[0] * 100| number :1 }}%</div><div>Bom ------ {{row.entity.PorcentagemOpiniao[1] * 100| number :1 }}%</div><div>Ruim ----- {{row.entity.PorcentagemOpiniao[2] * 100| number :1 }}%</div><div>Regular -- {{row.entity.PorcentagemOpiniao[3] * 100| number :1 }}%</div>"},{field:"notaMedia",displayName:"Nota média"}]},o.modalInserirEditar=function(r){var e=a+"Books/find",s={id_usuario:r.id_usuario};i.post(e,s).success(function(r){r.length>=1?o.dadosLivros=r:n.error("Este usuário não avaliou nenhum livro!")}).error(function(o){n.error("Não foi possível realizar a pesquisa!")}),o.opiniao=r.observacao_opiniao},o.pesquisarUsuarios=function(){o.dadosPesquisa=t("filter")(o.dadosLivros,o.opcaoBusca),o.gridOptions1.data=o.dadosPesquisa},o.carregaLivros()}]),app.controller("relatoriosUsuariosController",["$scope","$rootScope","BASEURL","$window","$http","$timeout","$filter","toastr",function(o,r,a,e,i,s,t,n){o.carregaUsuarios=function(){var r=a+"users/avg";i.post(r).success(function(r){r.length>=1?(o.showDiv=!0,o.dadosUsuarios=r,o.gridOptions1.data=r):n.error("Não existe nenhum usuário cadastrado!")}).error(function(o){n.error("Não foi possível realizar a pesquisa!")})},o.gridOptions1={enableSorting:!0,paginationPageSizes:[10,50,75],paginationPageSize:10,enableVerticalScrollbar:0,rowHeight:35,columnDefs:[{field:"id_usuario",displayName:"Código"},{field:"nome_usuario",displayName:"Nome"},{field:"media",displayName:"Nota Média"},{displayName:"Lista de livros",name:" ",enableColumnMenu:!1,cellTemplate:'<a role="button" class="table-icon" data-tipo="Livros" ng-click="grid.appScope.modalInserirEditar(row.entity);"><i class="fa fa-search-plus" aria-hidden="true"></i></a>'}]},o.modalInserirEditar=function(r){o.dadosLivros="";var e=a+"Books/find",s={id_usuario:r.id_usuario};i.post(e,s).success(function(r){r.length>=1?($("#modalInserirEditar").modal("toggle"),o.dadosLivros=r):n.error("Este usuário não avaliou nenhum livro!")}).error(function(o){n.error("Não foi possível realizar a pesquisa!")}),o.opiniao=r.observacao_opiniao},o.pesquisarUsuarios=function(){o.dadosPesquisa=t("filter")(o.dadosUsuarios,o.opcaoBusca),o.gridOptions1.data=o.dadosPesquisa},o.carregaUsuarios()}]),app.controller("usuarioController",["$scope","BASEURL","$http","$filter","toastr",function(o,r,a,e,i){o.showDiv=!1,o.carregaUsuarios=function(){var e=r+"users";a.put(e).success(function(r){r.length>=1?(o.dadosUsuarios=r,angular.forEach(o.dadosUsuarios,function(r,a){r.nivel_usuario=r.nivel_usuario,r.nivelExibicao=o.retornarDescricaoNivel(r.nivel_usuario),r.ativo_usuario=r.ativo_usuario,r.ativoExibicao=o.retornarDescricaoStatus(r.ativo_usuario)}),o.gridOptions1.data=o.dadosUsuarios):i.error("Não existe nenhum usuário cadastrado!")}).error(function(o){i.error("Não foi possível realizar a pesquisa!")})},o.gridOptions1={enableSorting:!0,paginationPageSizes:[10,50,75],paginationPageSize:10,enableVerticalScrollbar:0,rowHeight:35,rowTemplate:'<div ng-class="{ inativo : row.entity.ativo_usuario==0 }"> <div ng-repeat="col in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ui-grid-cell></div></div>',columnDefs:[{name:" ",enableColumnMenu:!1,cellTemplate:'<a role="button" data-toggle="modal" data-target="#modalInserirEditar" class="table-icon" data-tipo="Editar" ng-click="grid.appScope.modalAlterarUsuario(row.entity);"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>',width:30},{field:"nome_usuario",displayName:"Nome"},{field:"login_usuario",displayName:"Login"},{field:"email_usuario",displayName:"Email",width:200},{field:"ativoExibicao",displayName:"Ativo",width:110}]},o.pesquisarUsuarios=function(){if(o.showDiv=!0,void 0===o.opcaoBusca||""===o.opcaoBusca)o.carregaUsuarios();else if(void 0===o.opcaoBusca&&""===o.opcaoBusca||""!==o.gridOptions1.data&&void 0!==o.gridOptions1.data)o.dadosUsuariosCopy=angular.copy(o.dadosUsuarios),o.opcaoBuscaCopy=angular.copy(o.opcaoBusca),o.dadosUsuariosCopy=e("filter")(o.dadosUsuariosCopy,o.opcaoBuscaCopy),o.gridOptions1.data=o.dadosUsuariosCopy;else{var s=r+"users";a.put(s).success(function(r){r.length>=1?(o.dadosUsuarios=r,angular.forEach(o.dadosUsuarios,function(r,a){r.nivel_usuario=r.nivel_usuario,r.nivelExibicao=o.retornarDescricaoNivel(r.nivel_usuario),r.ativo_usuario=r.ativo_usuario,r.ativoExibicao=o.retornarDescricaoStatus(r.ativo_usuario)}),o.dadosUsuariosCopy=angular.copy(o.dadosUsuarios),o.opcaoBuscaCopy=angular.copy(o.opcaoBusca),o.dadosUsuariosCopy=e("filter")(o.dadosUsuariosCopy,o.opcaoBuscaCopy),o.gridOptions1.data=o.dadosUsuariosCopy):i.error("Não foi possível carregar os dados, tente novamente mais tarde!")}).error(function(o){i.error("Não foi possível realizar a pesquisa!")})}},o.cadastrarUsuario=function(){if(o.cadastro.strSenha.length<6)i.error("Erro ao cadastrar o usuário: A senha digitada deve conter ao menos 6 caracteres!");else if(o.cadastro.strSenha!==o.cadastro.strSenhaConfirma)i.error("Erro ao cadastrar o usuário: As senhas digitadas devem ser iguais!");else if(o.cadastro.strNome.length>50)i.error("O numero máximo de caracteres para o nome é de 50.");else if(o.cadastro.strEmail.length>50)i.error("O numero máximo de caracteres para o nome é de 50.");else if(o.cadastro.strLogin.length>30)i.error("O numero máximo de caracteres para o login é de 30.");else if(o.cadastro.strLogin.indexOf(" ")>=1)i.error("O login não pode conter espaços.");else{var e=r+"users/register",s=o.cadastro;a.post(e,s).success(function(r){1==r.affectedRows?(i.success("Usuário cadastrado com sucesso!"),o.carregaUsuarios(),$("#modalInserirEditar").modal("toggle")):i.error("Não foi possivel cadastrar o usuário!")}).error(function(o){i.error("Erro ao cadastrar o usuário!")})}},o.modalAlterarUsuario=function(r){o.cadastro={intUsuario:r.id_usuario,blnAtivo:r.ativo_usuario,strSenha:"",strSenhaConfirma:"",strLogin:r.login_usuario,strNome:r.nome_usuario,strEmail:r.email_usuario,intNivel:r.nivel_usuario,intOpcao:"1"}},o.opcaoUsuario=function(r){"1"===r?o.alterarUsuario():o.cadastrarUsuario()},o.opcaoUsuarioCadastro=function(r){o.cadastro={blnAtivo:"0",strSenha:"",strSenhaConfirma:"",intNivel:"",strLogin:"",strNome:"",strEmail:"",intOpcao:"0"}},o.alterarUsuario=function(){if(o.cadastro.strSenha&&o.cadastro.strSenha.length<6)i.error("Erro ao alterar o usuário: A senha digitada deve conter ao menos 6 caracteres!");else if(o.cadastro.strSenha&&o.cadastro.strSenha!==o.cadastro.strSenhaConfirma)i.error("Erro ao alterar o usuário: As senhas digitadas devem ser iguais!");else{var e=r+"users/update",s=o.cadastro;a.post(e,s).success(function(r){1==r.affectedRows?(i.success("Usuário alterado com sucesso!"),o.carregaUsuarios(),$("#modalInserirEditar").modal("toggle")):i.error("Não foi possível alterar o usuário!")}).error(function(o){i.error("Não foi possível alterar o usuário!")})}},o.retornarDescricaoNivel=function(o){return o=parseInt(o),1===o?"Administrador":"Básico"},o.retornarDescricaoStatus=function(o){return o=parseInt(o),1===o?"Inativo":"Ativo"},o.pesquisarUsuarios()}]);